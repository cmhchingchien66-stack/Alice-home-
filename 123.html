<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š æ•æ·ç ”è¨æœƒå ±åç¾æ³å„€è¡¨æ¿</title>
    <!-- å¼•å…¥ Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Chart.js for visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <style>
        /* --- Rose Gold Dark Theme Styling --- */
        body {
            background-color: #0F172A; /* Slate 900 - æ·±è‰²èƒŒæ™¯ */
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
            color: #F8FAFC; /* é è¨­æ–‡å­—é¡è‰²ç‚ºæ·ºè‰² */
        }
        .dashboard-card {
            background-color: #1E293B; /* Slate 800 - æ·±è‰²å¡ç‰‡èƒŒæ™¯ */
            border-radius: 1rem;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.3); /* æ›´æ·±çš„é™°å½±ä»¥å¢å¼·ç«‹é«”æ„Ÿ */
            padding: 1.5rem;
            transition: transform 0.3s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }
        /* å®šç¾©æ–°çš„ç«ç‘°é‡‘è‰²èª¿ */
        .text-primary { color: #F472B6; } /* Rose 400 - ç«ç‘°é‡‘ä¸»è‰² */
        .bg-primary { background-color: #F472B6; }
        .text-secondary { color: #FDE68A; } /* Yellow 200 - è¼”åŠ©é‡‘è‰² */
        .border-primary { border-color: #F472B6; }
        .border-secondary { border-color: #FDE68A; }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #F472B6; /* Rose Gold spinner */
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Modal styles adjustments for dark theme */
        .modal { z-index: 1000; }
        .modal.open {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #1E293B; /* Dark modal background */
            color: #F8FAFC;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal.open .modal-content {
            transform: scale(1);
        }
        /* Make prose (LLM output) readable */
        #analysis-results h2, #analysis-results h3 {
            color: #F472B6; /* Rose Gold headings for clarity */
            border-bottom: 1px solid #334155; /* Slate 700 divider */
            padding-bottom: 0.5rem;
            margin-top: 1.5rem;
        }
        #analysis-results p, #analysis-results li {
            color: #E2E8F0; /* Slate 200 for body text */
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8 p-4 bg-slate-800/80 rounded-xl backdrop-blur-sm shadow-xl border-b-4 border-rose-400">
            <h1 class="text-3xl md:text-5xl font-extrabold text-rose-400 mb-2">
                æ•æ·æ€ç¶­ç ”è¨æœƒå ±åç¾æ³
            </h1>
            <p class="text-lg text-slate-400">
                å³æ™‚æ•¸æ“šåˆ†æ (Real-time Registration Data)
            </p>
        </header>

        <!-- Loading Indicator / Error Message -->
        <div id="loading" class="flex flex-col items-center justify-center p-12 dashboard-card my-8">
            <div class="spinner"></div>
            <p class="mt-4 text-xl font-semibold text-slate-300">æ­£åœ¨å¾ Google Sheets è¼‰å…¥è³‡æ–™...</p>
        </div>
        
        <div id="error-message" class="hidden p-6 bg-red-800 border-l-4 border-red-400 text-red-100 font-medium rounded-lg my-8">
            âš ï¸ è³‡æ–™è¼‰å…¥å¤±æ•—ã€‚è«‹**ç¢ºèª Apps Script ç¶²å€å·²æ›¿æ›**ã€å·²éƒ¨ç½²ï¼Œä¸”å­˜å–æ¬Šé™å·²è¨­ç‚º**ã€Œä»»ä½•äººã€**ã€‚
            <p id="error-details" class="text-sm mt-1"></p>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboard-content" class="hidden">
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8">
                <!-- Total Registrants - Primary Accent (Rose Gold) -->
                <div class="dashboard-card bg-rose-500 text-white text-center flex flex-col items-center justify-center h-40">
                    <p class="text-5xl font-extrabold" id="total-registrants">0</p>
                    <p class="text-lg mt-2 font-semibold">ç¸½å ±åäººæ•¸</p>
                </div>
                <!-- Snack Needed Count - Secondary Accent (Muted Gold) -->
                <div class="dashboard-card bg-amber-600 text-white text-center flex flex-col items-center justify-center h-40">
                    <p class="text-5xl font-extrabold" id="snack-yes-count">0</p>
                    <p class="text-lg mt-2 font-semibold">éœ€è¦é»å¿ƒäººæ•¸</p>
                </div>
                <!-- Pre-Question Count - Neutral Card (Rose Gold Accent) -->
                <div class="dashboard-card text-center flex flex-col items-center justify-center border-b-4 border-rose-400 h-40">
                    <p class="text-5xl font-extrabold text-rose-400" id="question-count">0</p>
                    <p class="text-lg mt-2 font-semibold text-slate-300">æœƒå‰æå•ç¸½æ•¸</p>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Chart 1: Job Title Breakdown -->
                <div class="dashboard-card">
                    <h2 class="text-xl font-bold text-slate-200 mb-4 border-b border-slate-700 pb-2">ä¾è·ç¨±åˆ†ä½ˆ (Job Title Breakdown)</h2>
                    <div class="h-96">
                        <canvas id="jobTitleChart"></canvas>
                    </div>
                </div>

                <!-- Chart 2: Snack Needed Breakdown -->
                <div class="dashboard-card">
                    <h2 class="text-xl font-bold text-slate-200 mb-4 border-b border-slate-700 pb-2">é»å¿ƒéœ€æ±‚æ¯”ä¾‹ (Snack Requirement)</h2>
                    <div class="h-96">
                        <canvas id="snackChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Full Registrant List -->
            <div class="dashboard-card mb-8">
                <h2 class="text-xl font-bold text-rose-400 mb-4 border-b border-rose-400 pb-2">ğŸ“‹ æ‰€æœ‰å ±åè€…åå–® (Full Registrant List)</h2>
                <div id="registrant-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 max-h-80 overflow-y-auto p-2">
                    <!-- Names will be inserted here -->
                </div>
            </div>

            <!-- Pre-Questions Table & Analysis Button -->
            <div class="dashboard-card overflow-x-auto">
                <div class="flex justify-between items-center mb-4 border-b border-rose-400 pb-2">
                    <h2 class="text-xl font-bold text-rose-400">æœƒå‰æå•ä¸€è¦½ (Attendee Inquiries)</h2>
                    <button 
                        id="analyze-questions-btn"
                        onclick="showAnalysisModal()"
                        class="px-4 py-2 bg-rose-500 text-white rounded-lg shadow-md hover:bg-rose-600 transition duration-150 flex items-center disabled:opacity-50"
                        disabled
                        title="è«‹å…ˆè¼‰å…¥å ±åè³‡æ–™">
                        âœ¨ æå•åˆ†æèˆ‡è¡Œå‹•å»ºè­°
                    </button>
                </div>
                
                <table id="questions-table" class="min-w-full divide-y divide-slate-700">
                    <thead class="bg-slate-700">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">æ™‚é–“</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">å§“å/å–®ä½</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">æå•å…§å®¹</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-700" id="questions-tbody">
                        <!-- Table rows will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Gemini Analysis Modal -->
    <div id="analysis-modal" class="modal">
        <div class="modal-content w-full md:w-3/4 lg:w-1/2">
            <div class="flex justify-between items-start mb-4">
                <h3 class="text-2xl font-bold text-rose-400">âœ¨ æ•æ·ç ”è¨æœƒæœƒå‰æå•åˆ†æ</h3>
                <button onclick="hideAnalysisModal()" class="text-slate-400 hover:text-slate-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div id="analysis-loading" class="flex items-center justify-center p-12 hidden">
                <div class="spinner w-8 h-8 border-rose-500 border-t-rose-500/50"></div>
                <p class="ml-4 text-lg text-slate-400">Gemini æ­£åœ¨åˆ†ææå•å…§å®¹ï¼Œè«‹ç¨å€™...</p>
            </div>

            <div id="analysis-results" class="prose max-w-none text-slate-200">
                <!-- LLM results will be injected here -->
            </div>

            <div id="analysis-error" class="text-red-400 mt-4 hidden">
                é€£ç·šéŒ¯èª¤æˆ– API å¤±æ•—ã€‚è«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯é€£ç·šæˆ– API ç‹€æ…‹ã€‚
            </div>
        </div>
    </div>

<script>
    // !!! ğŸ”´ é—œéµæ­¥é©Ÿï¼šå·²æ›¿æ›ç‚ºæ‚¨æä¾›çš„ Web App URL (çµå°¾ç‚º /exec) !!!
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby1UAwdg29gaBCElJxzsBL5aHXVAklqRzNy7mu3nok9-MvxmNWkXL8cqmRUZqClanzFug/exec'; 
    const GEMINI_API_KEY = ""; // ä¿æŒç©ºå­—ä¸²ï¼ŒCanvas Runtime æœƒè‡ªå‹•æä¾›
    const GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent";

    const loadingDiv = document.getElementById('loading');
    const errorDiv = document.getElementById('error-message');
    const errorDetails = document.getElementById('error-details');
    const dashboardContent = document.getElementById('dashboard-content');
    const analyzeBtn = document.getElementById('analyze-questions-btn');
    const analysisModal = document.getElementById('analysis-modal');
    const analysisLoading = document.getElementById('analysis-loading');
    const analysisResults = document.getElementById('analysis-results');
    const analysisError = document.getElementById('analysis-error');

    let allQuestions = []; // Global variable to store all questions

    // New Chart colors for Rose Gold Dark Theme
    const CHART_COLORS = [
        '#F472B6', // Rose 400 (Primary Accent - Rose Gold)
        '#FDE68A', // Yellow 200 (Secondary Accent - Muted Gold)
        '#EAB308', // Amber 500
        '#9CA3AF', // Gray 400
        '#A78BFA', // Violet 400 (Muted Secondary)
        '#BEF264', // Lime 400
    ];

    // --- Modal Control ---
    function showAnalysisModal() {
        analysisModal.classList.add('open');
        generateQuestionAnalysis();
    }

    function hideAnalysisModal() {
        analysisModal.classList.remove('open');
    }

    // --- Utility Functions ---

    // Function to calculate counts for charts
    function calculateCounts(data, key) {
        const counts = {};
        data.forEach(item => {
            const value = item[key] || 'æœªå¡«å¯«';
            counts[value] = (counts[value] || 0) + 1;
        });
        return counts;
    }

    // Function to render a Doughnut/Pie Chart
    function renderChart(ctxId, type, dataCounts, labelText) {
        // Find existing chart instance and destroy it to prevent duplicates on refresh
        const existingChart = Chart.getChart(ctxId);
        if (existingChart) {
            existingChart.destroy();
        }

        const labels = Object.keys(dataCounts);
        const data = Object.values(dataCounts);
        
        // Prepare background colors, cycling through the palette
        const backgroundColors = labels.map((_, index) => CHART_COLORS[index % CHART_COLORS.length]);

        new Chart(document.getElementById(ctxId), {
            type: type,
            data: {
                labels: labels,
                datasets: [{
                    label: labelText,
                    data: data,
                    backgroundColor: backgroundColors,
                    hoverOffset: 4
                }]
            },
            // Update scales/tooltips for better dark theme visibility
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: { family: 'Inter', size: 14, color: '#E2E8F0' } // Light legend text
                        }
                    },
                    tooltip: {
                        bodyFont: { family: 'Inter' },
                        titleFont: { family: 'Inter', weight: 'bold' },
                    }
                }
            }
        });
    }

    // --- Gemini API Function: Analyze Questions ---
    async function generateQuestionAnalysis() {
        analysisResults.innerHTML = '';
        analysisError.classList.add('hidden');
        analysisLoading.classList.remove('hidden');

        if (allQuestions.length === 0) {
            analysisResults.innerHTML = '<p class="text-lg text-slate-400">ç›®å‰æ²’æœ‰æœƒå‰æå•å¯ä»¥åˆ†æã€‚</p>';
            analysisLoading.classList.add('hidden');
            return;
        }

        // 1. æº–å‚™æå•è³‡æ–™èˆ‡æ´»å‹•èƒŒæ™¯
        const questionsList = allQuestions.map((q, index) => `${index + 1}. ${q}`).join('\n');
        
        const systemPrompt = `
            Act as a professional event preparation consultant. Analyze the attendee questions for the "Agile Mindset in Education Administration" workshop.
            Your output MUST be in Traditional Chinese. Use Markdown formatting for readability, specifically:
            - **ä¸»é¡Œåˆ†æ (Theme Analysis)**: Summarize the main 2-3 themes or concerns raised by the attendees.
            - **è¬›å¸«æº–å‚™é‡é» (Key Speaker Preparation Points)**: Suggest 2-3 specific action items for the presenters to address these themes, referencing the event's focus.
            - **ç‰©è³‡æº–å‚™å»ºè­° (Resource Suggestion)**: Suggest 1-2 practical resources or materials needed for the workshop based on the questions and the workshop context (Kanban/Iteration).
            Ensure the response is structured using clear Markdown headings (e.g., ## ä¸»é¡Œåˆ†æ).
        `;

        const userQuery = `
            æ´»å‹•èƒŒæ™¯ï¼š
            - ä¸»é¡Œï¼šæ•æ·æ€ç¶­å°å…¥æ•™å­¸è¡Œæ”¿
            - ç›®çš„ï¼šåˆ†äº«ã€Œæ•æ·é–‹ç™¼ (Agile)ã€çš„æ ¸å¿ƒç²¾ç¥ï¼Œæ¢è¨å¦‚ä½•å°‡å…¶æ‡‰ç”¨æ–¼æ•™å­¸éƒ¨çš„æ—¥å¸¸è¡Œæ”¿ã€å°ˆæ¡ˆç®¡ç† (å¦‚ QCCã€OSCE ç±Œå‚™) ä¸­ï¼Œåˆ©ç”¨ã€Œè¦–è¦ºåŒ–çœ‹æ¿ (Kanban)ã€èˆ‡ã€Œè¿­ä»£ (Iteration)ã€ä¾†å„ªåŒ–æµç¨‹ã€‚
            - è½çœ¾ï¼šæ•™è‚²è¡Œæ”¿äººå“¡/æ•™å­¸éƒ¨äººå“¡ã€‚

            ä»¥ä¸‹æ˜¯æ‰€æœ‰çš„æœƒå‰æå•ï¼ˆå…± ${allQuestions.length} å‰‡ï¼‰ï¼š
            ---
            ${questionsList}
            ---
            è«‹æ ¹æ“šä¸Šè¿°èƒŒæ™¯å’Œæå•ï¼Œæä¾›åˆ†æå’Œå»ºè­°ã€‚
        `;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
            // ä¸éœ€è¦ Google Search groundingï¼Œå› ç‚ºåˆ†ææ˜¯åŸºæ–¼æä¾›çš„å…§éƒ¨è³‡æ–™
        };
        
        // å¯¦æ–½æŒ‡æ•¸é€€é¿ï¼ˆExponential Backoffï¼‰é‡è©¦æ©Ÿåˆ¶
        const maxRetries = 3;
        let attempt = 0;
        
        while (attempt < maxRetries) {
            try {
                const url = `${GEMINI_API_URL}?key=${GEMINI_API_KEY}`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }

                const result = await response.json();
                
                // è§£æçµæœ
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (text) {
                    analysisResults.innerHTML = text;
                    analysisLoading.classList.add('hidden');
                    return; // æˆåŠŸï¼Œé€€å‡ºå¾ªç’°
                } else {
                    throw new Error("API response structure missing text.");
                }

            } catch (error) {
                console.error(`Gemini API Call Attempt ${attempt + 1} Failed:`, error);
                attempt++;
                if (attempt < maxRetries) {
                    const delay = Math.pow(2, attempt) * 1000; // 1s, 2s, 4s delay
                    await new Promise(resolve => setTimeout(resolve, delay));
                } else {
                    analysisError.classList.remove('hidden');
                    analysisResults.innerHTML = '<p class="text-red-400">ç„¡æ³•å®Œæˆæå•åˆ†æã€‚è«‹ç¨å¾Œå†è©¦ã€‚</p>';
                    analysisLoading.classList.add('hidden');
                }
            }
        }
    }

    // --- Main Data Fetch and Render ---

    async function fetchRegistrationData() {
        loadingDiv.classList.remove('hidden');
        dashboardContent.classList.add('hidden');
        errorDiv.classList.add('hidden');
        analyzeBtn.disabled = true; // Disable analysis button initially

        try {
            console.log('Attempting to fetch data from URL:', APPS_SCRIPT_URL);

            // æ ¼å¼æª¢æŸ¥
            if (!APPS_SCRIPT_URL.startsWith('https://') || !APPS_SCRIPT_URL.includes('/exec')) {
                 throw new Error('Apps Script ç¶²å€æ ¼å¼ä¸æ­£ç¢ºã€‚è«‹ç¢ºèªå®ƒæ˜¯ä¸€å€‹ä»¥ "https://" é–‹é ­ï¼Œä¸”ä»¥ "/exec" çµå°¾çš„ Web App URLã€‚');
            }

            // ä½¿ç”¨ GET è«‹æ±‚ç²å–å„€è¡¨æ¿è³‡æ–™
            const response = await fetch(APPS_SCRIPT_URL, {
                method: 'GET',
                mode: 'cors',
                cache: 'no-cache',
                credentials: 'omit',
                headers: { 'Accept': 'application/json' }
            });

            if (!response.ok) {
                throw new Error(`HTTP Error Status: ${response.status}. é€™é€šå¸¸è¡¨ç¤º Apps Script ç¶²å€ç„¡æ•ˆæˆ–éƒ¨ç½²æœ‰èª¤ã€‚`);
            }

            const result = await response.json();

            if (!result.success) {
                throw new Error(result.message || 'Apps Script è¿”å›å¤±æ•—è¨Šæ¯ã€‚è«‹æª¢æŸ¥ Google Sheets åˆ†é åç¨±æ˜¯å¦ç‚ºã€Œå ±åè³‡æ–™ã€ã€‚');
            }

            renderDashboard(result.data);

        } catch (error) {
            console.error('Fetching data failed:', error);
            errorDetails.innerHTML = `éŒ¯èª¤è©³æƒ…ï¼š${error.message || 'é€£ç·šéŒ¯èª¤ (Failed to fetch)ã€‚'}
                <ul class="list-disc list-inside mt-2">
                    <li>è«‹ç¢ºèªï¼šApps Script éƒ¨ç½²å¾Œï¼Œã€Œèª°æ“æœ‰å­˜å–æ¬Šã€è¨­ç‚º**ã€Œä»»ä½•äººã€**ã€‚</li>
                    <li>è«‹ç¢ºèªï¼šGoogle Sheets ä¸­çš„è³‡æ–™åˆ†é åç¨±æ˜¯å¦ç‚º**ã€Œå ±åè³‡æ–™ã€**ã€‚</li>
                </ul>`;
            errorDiv.classList.remove('hidden');
        } finally {
            loadingDiv.classList.add('hidden');
        }
    }

    function renderDashboard(data) {
        if (!data || data.length === 0) {
            document.getElementById('total-registrants').textContent = '0';
            document.getElementById('total-registrants').nextElementSibling.textContent = 'å°šç„¡å ±åè³‡æ–™';
            dashboardContent.classList.remove('hidden');
            
            // è™•ç†åå–®å’Œæå•åˆ—è¡¨ç‚ºç©º
            document.getElementById('registrant-list').innerHTML = '<p class="text-slate-400 text-center col-span-5">ç„¡å ±åè€…ã€‚</p>';
            document.getElementById('questions-tbody').innerHTML = '<tr><td colspan="3" class="px-6 py-4 text-center text-sm text-slate-400">ç„¡æœƒå‰æå•ã€‚</td></tr>';
            
            return;
        }

        // 1. Calculate Counts
        const totalCount = data.length;
        const jobTitleCounts = calculateCounts(data, 'è·ç¨±');
        const snackCounts = calculateCounts(data, 'æ˜¯å¦éœ€è¦èŒ¶æ°´é»å¿ƒ');
        
        // Filter and store pre-questions in global variable
        const questionsData = data.filter(item => item['æœƒå‰æå•'] && item['æœƒå‰æå•'].trim() !== '');
        allQuestions = questionsData.map(item => item['æœƒå‰æå•']);
        
        const snackYesCount = snackCounts['æ˜¯'] || 0;
        const questionCount = questionsData.length;

        // 2. Update Summary Cards
        document.getElementById('total-registrants').textContent = totalCount;
        document.getElementById('snack-yes-count').textContent = snackYesCount;
        document.getElementById('question-count').textContent = questionCount;

        // 3. Render Charts
        renderChart('jobTitleChart', 'doughnut', jobTitleCounts, 'å ±åè·ç¨±åˆ†ä½ˆ');
        renderChart('snackChart', 'pie', snackCounts, 'é»å¿ƒéœ€æ±‚');

        // 4. Render Full Registrant List
        const registrantListDiv = document.getElementById('registrant-list');
        registrantListDiv.innerHTML = ''; // Clear previous data

        if (data.length > 0) {
            data.forEach(item => {
                const name = item['å§“å'] || 'æœªçŸ¥å§“å';
                const unit = item['å–®ä½'] || 'æœªçŸ¥å–®ä½';
                
                const div = document.createElement('div');
                // ä½¿ç”¨ text-rose-400 å’Œ text-yellow-200 å¢å¼·è¦–è¦ºæ•ˆæœ
                div.className = 'p-3 bg-slate-700 rounded-lg shadow-inner hover:bg-slate-600 transition duration-150 cursor-default border-l-4 border-rose-500'; 
                div.innerHTML = `
                    <p class="font-semibold text-rose-100">${name}</p>
                    <p class="text-xs text-slate-400 truncate">${unit}</p>
                `;
                registrantListDiv.appendChild(div);
            });
        } else {
             registrantListDiv.innerHTML = '<p class="text-slate-400 text-center col-span-5">ç„¡å ±åè€…ã€‚</p>';
        }

        // 5. Render Questions Table
        const tbody = document.getElementById('questions-tbody');
        tbody.innerHTML = ''; // Clear previous data
        
        if (questionsData.length > 0) {
            questionsData.forEach(item => {
                const row = tbody.insertRow();
                row.className = 'hover:bg-slate-700 transition duration-150'; /* Updated hover color */

                // å ±åæ™‚é–“
                row.insertCell().textContent = item['å ±åæ™‚é–“'].substring(0, 10); // åªé¡¯ç¤ºæ—¥æœŸ
                row.cells[0].className = 'px-6 py-4 whitespace-nowrap text-sm text-slate-400';

                // å§“å/å–®ä½
                row.insertCell().innerHTML = `<div class="font-medium text-slate-100">${item['å§“å']}</div>
                                              <div class="text-xs text-slate-400">${item['å–®ä½']}</div>`;
                row.cells[1].className = 'px-6 py-4 whitespace-nowrap';

                // æå•å…§å®¹
                row.insertCell().textContent = item['æœƒå‰æå•'];
                row.cells[2].className = 'px-6 py-4 text-sm text-slate-200 break-words';
            });
        } else {
            tbody.innerHTML = '<tr><td colspan="3" class="px-6 py-4 text-center text-sm text-slate-400">ç„¡æœƒå‰æå•ã€‚</td></tr>';
        }


        // 6. Enable Analysis Button if there are questions
        if (questionCount > 0) {
            analyzeBtn.disabled = false;
            analyzeBtn.title = `é»æ“Šåˆ†æ ${questionCount} å‰‡æå•`;
        } else {
            analyzeBtn.disabled = true;
            analyzeBtn.title = 'å°šç„¡æœƒå‰æå•å¯ä¾›åˆ†æ';
        }

        // Show content
        dashboardContent.classList.remove('hidden');
    }
    
    // Initial fetch on load
    window.onload = fetchRegistrationData;

    // Optional: Auto-refresh data every 60 seconds
    setInterval(fetchRegistrationData, 60000); 

</script>

</body>
</html>
